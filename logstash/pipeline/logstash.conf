input {
  beats {
    port => 5044
  }
}

filter {
  grok {
    match => { "message" => ["%{TIMESTAMP_ISO8601:timestamp} %{WORD:program}: %{GREEDYDATA:msg}",
                             "%{SYSLOGTIMESTAMP:ts} %{SYSLOGHOST:host} %{WORD:program}: %{GREEDYDATA:msg}"] }
    remove_field => ["beat", "input", "host"]
  }

  if "Failed password" in [message] {
    grok {
      match => { "msg" => "Failed password for (?:invalid user )?(?:%{USERNAME:user} )?from %{IP:src_ip} port %{NUMBER:src_port}" }
    }
    mutate { add_field => { "status" => "failed" } }
  } else if "Accepted password" in [message] {
    grok {
      match => { "msg" => "Accepted password for %{USERNAME:user} from %{IP:src_ip} port %{NUMBER:src_port}" }
    }
    mutate { add_field => { "status" => "success" } }
  }

  date {
    match => [ "timestamp", "ISO8601" ]
    target => "@timestamp"
  }
}

output {
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    index => "filebeat-%{+YYYY.MM.dd}"
  }
  stdout { codec => rubydebug }
}
a